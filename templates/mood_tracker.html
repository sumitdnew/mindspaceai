<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mood Tracker - MindSpace ML</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }



        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .mood-tracker-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 40px;
            margin-bottom: 30px;
        }

        .streak-banner {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        .streak-number {
            font-size: 3rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .mood-section {
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .emoji-option {
            background: #f8f9fa;
            border: 3px solid transparent;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .emoji-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            border-color: #007bff;
        }

        .emoji-option.selected {
            border-color: #28a745;
            background: #d4edda;
            transform: scale(1.05);
        }

        .emoji-option .emoji {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .emoji-option .name {
            font-size: 0.8rem;
            color: #666;
        }

        .slider-section {
            margin-bottom: 30px;
        }

        .slider-container {
            margin-bottom: 25px;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .slider-value {
            background: #007bff;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9rem;
            min-width: 40px;
            text-align: center;
        }

        .slider {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #e9ecef;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #007bff;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .slider::-moz-range-thumb {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #007bff;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .intensity-slider {
            background: linear-gradient(to right, #dc3545, #ffc107, #28a745);
        }

        .energy-slider {
            background: linear-gradient(to right, #6c757d, #17a2b8, #28a745);
        }

        .sleep-slider {
            background: linear-gradient(to right, #6c757d, #ffc107, #28a745);
        }

        .weather-section {
            margin-bottom: 30px;
        }

        .weather-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
        }

        .weather-option {
            background: #f8f9fa;
            border: 2px solid transparent;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .weather-option:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            border-color: #007bff;
        }

        .weather-option.selected {
            border-color: #28a745;
            background: #d4edda;
        }

        .weather-option .weather-emoji {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .weather-option .description {
            font-size: 0.7rem;
            color: #666;
            line-height: 1.2;
        }

        .context-section {
            margin-bottom: 30px;
        }

        .context-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
        }

        .context-option {
            background: #f8f9fa;
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .context-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
            border-color: #007bff;
        }

        .context-option.selected {
            border-color: #28a745;
            background: #d4edda;
        }

        .energy-battery {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .battery-container {
            width: 100%;
            height: 40px;
            background: #e9ecef;
            border-radius: 20px;
            overflow: hidden;
            position: relative;
            margin: 10px 0;
        }

        .battery-level {
            height: 100%;
            background: linear-gradient(90deg, #dc3545, #ffc107, #28a745);
            transition: width 0.5s ease;
            border-radius: 20px;
        }

        .battery-text {
            text-align: center;
            font-weight: bold;
            color: #333;
        }

        .sleep-stars {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .stars-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
        }

        .star {
            font-size: 2rem;
            color: #e9ecef;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .star:hover,
        .star.active {
            color: #ffc107;
            transform: scale(1.1);
        }

        .submit-btn {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 20px;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,123,255,0.3);
        }

        .submit-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .insights-panel {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
        }

        .insights-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .insight-item {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            backdrop-filter: blur(10px);
        }

        .achievement-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            text-align: center;
            z-index: 1000;
            animation: achievementSlideIn 0.5s ease;
        }

        @keyframes achievementSlideIn {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .achievement-icon {
            font-size: 4rem;
            margin-bottom: 15px;
            color: #ffc107;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007bff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .mood-tracker-card {
                padding: 20px;
            }
            
            .emoji-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .weather-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .context-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
        <div class="container">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('patient_dashboard') }}">
                🧠 MindSpace ML
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="{{ url_for('phq9_assessment') }}">📋 PHQ-9 Assessment</a>
                <a class="nav-link" href="{{ url_for('journal') }}">📖 Journal</a>
                <a class="nav-link active" href="{{ url_for('mood_tracking.mood_tracker') }}">😊 Mood</a>
                <a class="nav-link" href="{{ url_for('mindfulness_exercises.mindfulness_dashboard') }}">🧘 Mindfulness</a>
                <a class="nav-link" href="{{ url_for('thought_record_dashboard') }}">🔍 Thought Detective</a>
                <a class="nav-link" href="{{ url_for('goals') }}">🎯 Goals</a>
                <a class="nav-link" href="{{ url_for('insights') }}">📈 Insights</a>
                <a class="nav-link" href="{{ url_for('logout') }}">Logout</a>
            </div>
        </div>
    </nav>

        <div class="header">
            <h1><i class="fas fa-heart"></i> Mood Tracker</h1>
            <p>Track your daily mood and discover patterns</p>
        </div>

        <!-- Streak Banner -->
        <div class="streak-banner">
            <h3><i class="fas fa-fire"></i> Your Streak</h3>
            <div class="streak-number">{{ streak_data.current_streak }}</div>
            <p>days of consistent mood tracking!</p>
            {% if streak_data.longest_streak > 0 %}
            <small>Longest streak: {{ streak_data.longest_streak }} days</small>
            {% endif %}
        </div>

        <div class="mood-tracker-card">
            <form id="moodForm">
                <!-- Mood Selection -->
                <div class="mood-section">
                    <div class="section-title">
                        <i class="fas fa-smile"></i>
                        How are you feeling today?
                    </div>
                    <div class="emoji-grid">
                        {% for emoji, data in mood_emojis.items() %}
                        <div class="emoji-option" data-emoji="{{ emoji }}" data-color="{{ data.color }}">
                            <div class="emoji">{{ emoji }}</div>
                            <div class="name">{{ data.name }}</div>
                        </div>
                        {% endfor %}
            </div>
        </div>

                <!-- Intensity Slider -->
                <div class="slider-section">
                    <div class="section-title">
                        <i class="fas fa-chart-line"></i>
                        Mood Intensity
                    </div>
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>How intense is this feeling?</span>
                            <span class="slider-value" id="intensityValue">5</span>
                                        </div>
                        <input type="range" class="slider intensity-slider" id="intensitySlider" 
                               min="1" max="10" value="5" step="1">
                                    </div>
                                </div>

                <!-- Energy Battery -->
                <div class="energy-battery">
                    <div class="section-title">
                        <i class="fas fa-battery-full"></i>
                        Energy Level
                    </div>
                    <div class="battery-container">
                        <div class="battery-level" id="batteryLevel" style="width: 50%"></div>
                    </div>
                    <div class="battery-text" id="batteryText">50% Energy</div>
                    <input type="range" class="slider energy-slider" id="energySlider" 
                           min="0" max="100" value="50" step="5">
                </div>

                <!-- Sleep Quality -->
                <div class="sleep-stars">
                    <div class="section-title">
                        <i class="fas fa-bed"></i>
                        Sleep Quality Last Night
                    </div>
                    <div class="stars-container">
                        {% for i in range(1, 6) %}
                        <div class="star" data-rating="{{ i }}">
                            <i class="fas fa-star"></i>
                            </div>
                        {% endfor %}
                        </div>
                    <div style="text-align: center; margin-top: 10px;">
                        <span id="sleepRating">3 stars</span>
                </div>
            </div>
            
                <!-- Weather Metaphor -->
                <div class="weather-section">
                    <div class="section-title">
                        <i class="fas fa-cloud-sun"></i>
                        Weather Metaphor
                    </div>
                    <div class="weather-grid">
                        {% for emoji, description in weather_metaphors.items() %}
                        <div class="weather-option" data-weather="{{ emoji }}">
                            <div class="weather-emoji">{{ emoji }}</div>
                            <div class="description">{{ description }}</div>
                        </div>
                        {% endfor %}
                            </div>
                        </div>
                        
                <!-- Social Context -->
                <div class="context-section">
                    <div class="section-title">
                        <i class="fas fa-users"></i>
                        Social Context
                    </div>
                    <div class="context-grid">
                        {% for context in social_contexts %}
                        <div class="context-option" data-context="{{ context }}">
                            {{ context }}
                        </div>
                        {% endfor %}
                        </div>
                        </div>
                        
                <!-- Submit Button -->
                <button type="submit" class="submit-btn" id="submitBtn">
                    <i class="fas fa-save"></i> Save Mood Entry
                </button>
                    </form>

            <!-- Loading State -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Saving your mood entry...</p>
                </div>
            </div>

        <!-- Insights Panel -->
        <div class="insights-panel" id="insightsPanel" style="display: none;">
            <div class="insights-title">
                <i class="fas fa-lightbulb"></i>
                Your Mood Insights
            </div>
            <div id="insightsContent"></div>
        </div>
    </div>

    <!-- Achievement Popup -->
    <div class="overlay" id="overlay" style="display: none;"></div>
    <div class="achievement-popup" id="achievementPopup" style="display: none;">
        <div class="achievement-icon">
            <i class="fas fa-trophy"></i>
        </div>
        <h3 id="achievementTitle">Achievement Unlocked!</h3>
        <p id="achievementDescription">Great job!</p>
        <button onclick="closeAchievement()" style="margin-top: 15px; padding: 10px 20px; border: none; border-radius: 10px; background: #007bff; color: white; cursor: pointer;">
            Continue
        </button>
    </div>

    <script>
        // Global variables
        let selectedMood = null;
        let selectedWeather = '☀️';
        let selectedContext = 'Alone';
        let sleepRating = 3;

        // Initialize the interface
        document.addEventListener('DOMContentLoaded', function() {
            initializeSliders();
            initializeEmojiSelection();
            initializeWeatherSelection();
            initializeContextSelection();
            initializeStarRating();
            initializeForm();
        });

        function initializeSliders() {
            const intensitySlider = document.getElementById('intensitySlider');
            const intensityValue = document.getElementById('intensityValue');
            const energySlider = document.getElementById('energySlider');
            const batteryLevel = document.getElementById('batteryLevel');
            const batteryText = document.getElementById('batteryText');

            intensitySlider.addEventListener('input', function() {
                intensityValue.textContent = this.value;
            });

            energySlider.addEventListener('input', function() {
            const value = this.value;
                batteryLevel.style.width = value + '%';
                batteryText.textContent = value + '% Energy';
                
                // Change battery color based on level
                if (value < 30) {
                    batteryLevel.style.background = '#dc3545';
                } else if (value < 70) {
                    batteryLevel.style.background = '#ffc107';
                } else {
                    batteryLevel.style.background = '#28a745';
                }
            });
        }

        function initializeEmojiSelection() {
            const emojiOptions = document.querySelectorAll('.emoji-option');
            
            emojiOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // Remove previous selection
                    emojiOptions.forEach(opt => opt.classList.remove('selected'));
                    
                    // Select current option
                    this.classList.add('selected');
                    selectedMood = this.dataset.emoji;
                    
                    // Update intensity slider based on mood
                    const moodData = {{ mood_emojis | tojson }};
                    const intensityRange = moodData[selectedMood].intensity_range;
                    const avgIntensity = Math.round((intensityRange[0] + intensityRange[1]) / 2);
                    
                    document.getElementById('intensitySlider').value = avgIntensity;
                    document.getElementById('intensityValue').textContent = avgIntensity;
                });
            });
        }

        function initializeWeatherSelection() {
            const weatherOptions = document.querySelectorAll('.weather-option');
            
            weatherOptions.forEach(option => {
                option.addEventListener('click', function() {
                    weatherOptions.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedWeather = this.dataset.weather;
                });
            });
        }

        function initializeContextSelection() {
            const contextOptions = document.querySelectorAll('.context-option');
            
            contextOptions.forEach(option => {
                option.addEventListener('click', function() {
                    contextOptions.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedContext = this.dataset.context;
                });
            });
        }

        function initializeStarRating() {
            const stars = document.querySelectorAll('.star');
            const sleepRatingText = document.getElementById('sleepRating');
            
            stars.forEach((star, index) => {
                star.addEventListener('click', function() {
                    const rating = index + 1;
                    sleepRating = rating;
                    
                    // Update star display
                    stars.forEach((s, i) => {
                        if (i < rating) {
                            s.classList.add('active');
                        } else {
                            s.classList.remove('active');
                        }
                    });
                    
                    sleepRatingText.textContent = rating + ' star' + (rating > 1 ? 's' : '');
                });
            });
        }

        function initializeForm() {
            const form = document.getElementById('moodForm');
            const submitBtn = document.getElementById('submitBtn');
            const loading = document.getElementById('loading');
            
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                if (!selectedMood) {
                    alert('Please select a mood!');
                    return;
                }
                
                // Disable submit button and show loading
                submitBtn.disabled = true;
                loading.style.display = 'block';
                
                const formData = {
                    mood_emoji: selectedMood,
                    intensity_level: parseInt(document.getElementById('intensitySlider').value),
                    energy_level: parseInt(document.getElementById('energySlider').value),
                    sleep_quality: sleepRating,
                    weather_metaphor: selectedWeather,
                    social_context: selectedContext,
                    color_selection: '{{ mood_emojis[selectedMood].color if selectedMood else "#4CAF50" }}',
                    notes_brief: ''
                };
                
                try {
                    const response = await fetch('/api/mood-entry', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(formData)
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        // Show achievements if any
                        if (result.achievements && result.achievements.length > 0) {
                            showAchievement(result.achievements[0]);
                        }
                        
                        // Show insights
                        showInsights(result.insights);
                        
                        // Reset form
                        resetForm();
                        
                        // Show success message
                        alert('Mood entry saved successfully!');
                    } else {
                        alert('Error saving mood entry: ' + result.error);
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('Error saving mood entry. Please try again.');
                } finally {
                    // Re-enable submit button and hide loading
                    submitBtn.disabled = false;
                    loading.style.display = 'none';
                }
            });
        }

        function showAchievement(achievement) {
            document.getElementById('achievementTitle').textContent = achievement.name;
            document.getElementById('achievementDescription').textContent = achievement.description;
            document.getElementById('overlay').style.display = 'block';
            document.getElementById('achievementPopup').style.display = 'block';
        }

        function closeAchievement() {
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('achievementPopup').style.display = 'none';
        }

        function showInsights(insights) {
            const insightsPanel = document.getElementById('insightsPanel');
            const insightsContent = document.getElementById('insightsContent');
            
            let html = '';
            
            if (insights.insights && insights.insights.length > 0) {
                html += '<h4>Recent Patterns:</h4>';
                insights.insights.forEach(insight => {
                    html += `<div class="insight-item">${insight}</div>`;
                });
            }
            
            if (insights.suggestions && insights.suggestions.length > 0) {
                html += '<h4>Suggestions:</h4>';
                insights.suggestions.forEach(suggestion => {
                    html += `<div class="insight-item">${suggestion}</div>`;
                });
            }
            
            insightsContent.innerHTML = html;
            insightsPanel.style.display = 'block';
        }

        function resetForm() {
            // Reset selections
            document.querySelectorAll('.emoji-option').forEach(opt => opt.classList.remove('selected'));
            document.querySelectorAll('.weather-option').forEach(opt => opt.classList.remove('selected'));
            document.querySelectorAll('.context-option').forEach(opt => opt.classList.remove('selected'));
            document.querySelectorAll('.star').forEach(star => star.classList.remove('active'));
            
            // Reset values
            selectedMood = null;
            selectedWeather = '☀️';
            selectedContext = 'Alone';
            sleepRating = 3;
            
            document.getElementById('intensitySlider').value = 5;
            document.getElementById('intensityValue').textContent = '5';
            document.getElementById('energySlider').value = 50;
            document.getElementById('batteryLevel').style.width = '50%';
            document.getElementById('batteryText').textContent = '50% Energy';
            document.getElementById('sleepRating').textContent = '3 stars';
            
            // Activate 3rd star
            document.querySelectorAll('.star')[2].classList.add('active');
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html> 