<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PHQ-9 Assessment Results - MindSpace ML</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .results-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin: 30px auto;
            max-width: 1200px;
            overflow: hidden;
        }
        
        .header-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        .score-display {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .severity-badge {
            font-size: 1.2em;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
        }
        
        .severity-minimal { background: #d4edda; color: #155724; }
        .severity-mild { background: #fff3cd; color: #856404; }
        .severity-moderate { background: #f8d7da; color: #721c24; }
        .severity-moderately_severe { background: #f5c6cb; color: #721c24; }
        .severity-severe { background: #dc3545; color: white; }
        
        .exercise-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin: 15px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border-left: 5px solid #667eea;
            transition: transform 0.3s ease;
        }
        
        .exercise-card:hover {
            transform: translateY(-5px);
        }
        
        .exercise-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
            color: #667eea;
        }
        
        .timer-display {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            text-align: center;
            margin: 20px 0;
        }
        
        .progress-bar {
            height: 8px;
            border-radius: 4px;
            background: #e9ecef;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }
        
        .btn-exercise {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn-exercise:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
            color: white;
        }
        
        .alert-crisis {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 20px;
            margin: 20px;
        }
        
        .question-breakdown {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px;
        }
        
        .question-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #dee2e6;
        }
        
        .question-item:last-child {
            border-bottom: none;
        }
        
        .score-indicator {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }
        
        .score-0 { background: #28a745; }
        .score-1 { background: #ffc107; }
        .score-2 { background: #fd7e14; }
        .score-3 { background: #dc3545; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('index') }}">
                üß† MindSpace ML
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="{{ url_for('patient_dashboard') }}">Dashboard</a>
                <a class="nav-link" href="{{ url_for('phq9_assessment') }}">üìã PHQ-9 Assessment</a>
                <a class="nav-link" href="{{ url_for('logout') }}">Logout</a>
            </div>
        </div>
    </nav>

    <div class="results-container">
        <!-- Header Section -->
        <div class="header-section">
            <h1><i class="fas fa-clipboard-check"></i> PHQ-9 Assessment Results</h1>
            <p class="lead">Your mental health assessment has been completed</p>
        </div>

        <!-- Crisis Alert (if applicable) -->
        {% if assessment.q9_risk_flag or assessment.total_score >= 20 %}
        <div class="alert-crisis">
            <h4><i class="fas fa-exclamation-triangle"></i> Important Notice</h4>
            <p><strong>Your assessment indicates you may be experiencing significant distress.</strong></p>
            <p>Please consider reaching out to a mental health professional or crisis helpline:</p>
            <ul>
                <li><strong>National Suicide Prevention Lifeline:</strong> 988 or 1-800-273-8255</li>
                <li><strong>Crisis Text Line:</strong> Text HOME to 741741</li>
                <li><strong>Emergency Services:</strong> 911</li>
            </ul>
            <p><em>You are not alone, and help is available 24/7.</em></p>
        </div>
        {% endif %}

        <!-- Score Display -->
        <div class="score-display">
            <div class="row">
                <div class="col-md-6">
                    <h3><i class="fas fa-chart-line"></i> Your Assessment Summary</h3>
                    <div class="row">
                        <div class="col-6">
                            <h2 class="text-primary">{{ assessment.total_score }}/27</h2>
                            <p><strong>Total Score</strong></p>
                        </div>
                        <div class="col-6">
                            <span class="severity-badge severity-{{ assessment.severity_level }}">
                                {{ assessment.severity_level.replace('_', ' ').title() }}
                            </span>
                            <p><strong>Severity Level</strong></p>
                        </div>
                    </div>
                    <p class="text-muted">Assessment Date: {{ assessment.assessment_date.strftime('%B %d, %Y at %I:%M %p') }}</p>
                </div>
                <div class="col-md-6">
                    <h4>What This Means</h4>
                    {% if assessment.severity_level == 'minimal' %}
                        <p>Your symptoms suggest minimal depression. Continue with your current routine and self-care practices.</p>
                    {% elif assessment.severity_level == 'mild' %}
                        <p>You're experiencing mild depressive symptoms. Consider incorporating some stress-reduction techniques.</p>
                    {% elif assessment.severity_level == 'moderate' %}
                        <p>You're showing moderate depressive symptoms. Regular exercise and social connection can be very helpful.</p>
                    {% elif assessment.severity_level == 'moderately_severe' %}
                        <p>Your symptoms are moderately severe. Professional support may be beneficial at this time.</p>
                    {% else %}
                        <p>Your symptoms are severe. Professional mental health support is strongly recommended.</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Question Breakdown -->
        <div class="question-breakdown">
            <h4><i class="fas fa-list-ul"></i> Question Breakdown</h4>
            <div class="question-item">
                <span><strong>1.</strong> Little interest or pleasure in doing things</span>
                <span class="score-indicator score-{{ assessment.q1_score }}">{{ assessment.q1_score }}</span>
            </div>
            <div class="question-item">
                <span><strong>2.</strong> Feeling down, depressed, or hopeless</span>
                <span class="score-indicator score-{{ assessment.q2_score }}">{{ assessment.q2_score }}</span>
            </div>
            <div class="question-item">
                <span><strong>3.</strong> Trouble falling/staying asleep, sleeping too much</span>
                <span class="score-indicator score-{{ assessment.q3_score }}">{{ assessment.q3_score }}</span>
            </div>
            <div class="question-item">
                <span><strong>4.</strong> Feeling tired or having little energy</span>
                <span class="score-indicator score-{{ assessment.q4_score }}">{{ assessment.q4_score }}</span>
            </div>
            <div class="question-item">
                <span><strong>5.</strong> Poor appetite or overeating</span>
                <span class="score-indicator score-{{ assessment.q5_score }}">{{ assessment.q5_score }}</span>
            </div>
            <div class="question-item">
                <span><strong>6.</strong> Feeling bad about yourself</span>
                <span class="score-indicator score-{{ assessment.q6_score }}">{{ assessment.q6_score }}</span>
            </div>
            <div class="question-item">
                <span><strong>7.</strong> Trouble concentrating</span>
                <span class="score-indicator score-{{ assessment.q7_score }}">{{ assessment.q7_score }}</span>
            </div>
            <div class="question-item">
                <span><strong>8.</strong> Moving or speaking slowly/being fidgety</span>
                <span class="score-indicator score-{{ assessment.q8_score }}">{{ assessment.q8_score }}</span>
            </div>
            <div class="question-item">
                <span><strong>9.</strong> Thoughts of self-harm or being better off dead</span>
                <span class="score-indicator score-{{ assessment.q9_score }}">{{ assessment.q9_score }}</span>
            </div>
        </div>

        <!-- Interactive Exercise Recommendations -->
        <div style="padding: 20px;">
            <h3><i class="fas fa-dumbbell"></i> Personalized Exercise Recommendations</h3>
            <p class="text-muted">Based on your assessment, here are some exercises that may help:</p>
            
            <!-- Breathing Exercise -->
            <div class="exercise-card">
                <div class="row">
                    <div class="col-md-2 text-center">
                        <div class="exercise-icon">ü´Å</div>
                    </div>
                    <div class="col-md-8">
                        <h5>Deep Breathing Exercise</h5>
                        <p>Practice deep breathing to reduce stress and anxiety. This simple technique can help calm your nervous system.</p>
                        <div class="timer-display" id="breathing-timer">5:00</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="breathing-progress" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="col-md-2 text-center">
                        <button class="btn btn-exercise" onclick="startBreathingExercise()">
                            <i class="fas fa-play"></i> Start
                        </button>
                    </div>
                </div>
            </div>

            <!-- Progressive Muscle Relaxation -->
            <div class="exercise-card">
                <div class="row">
                    <div class="col-md-2 text-center">
                        <div class="exercise-icon">üßò‚Äç‚ôÄÔ∏è</div>
                    </div>
                    <div class="col-md-8">
                        <h5>Progressive Muscle Relaxation</h5>
                        <p>Systematically tense and relax different muscle groups to reduce physical tension and mental stress.</p>
                        <div class="timer-display" id="pmr-timer">10:00</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="pmr-progress" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="col-md-2 text-center">
                        <button class="btn btn-exercise" onclick="startPMRExercise()">
                            <i class="fas fa-play"></i> Start
                        </button>
                    </div>
                </div>
            </div>

            <!-- Guided Meditation -->
            <div class="exercise-card">
                <div class="row">
                    <div class="col-md-2 text-center">
                        <div class="exercise-icon">üßò‚Äç‚ôÇÔ∏è</div>
                    </div>
                    <div class="col-md-8">
                        <h5>Guided Meditation</h5>
                        <p>Follow a guided meditation session to center your mind and reduce negative thoughts.</p>
                        <div class="timer-display" id="meditation-timer">15:00</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="meditation-progress" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="col-md-2 text-center">
                        <button class="btn btn-exercise" onclick="startMeditationExercise()">
                            <i class="fas fa-play"></i> Start
                        </button>
                    </div>
                </div>
            </div>

            <!-- Physical Activity -->
            <div class="exercise-card">
                <div class="row">
                    <div class="col-md-2 text-center">
                        <div class="exercise-icon">üèÉ‚Äç‚ôÄÔ∏è</div>
                    </div>
                    <div class="col-md-8">
                        <h5>Light Physical Activity</h5>
                        <p>Engage in gentle physical activity like walking or stretching to boost your mood and energy levels.</p>
                        <div class="timer-display" id="activity-timer">20:00</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="activity-progress" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="col-md-2 text-center">
                        <button class="btn btn-exercise" onclick="startActivityExercise()">
                            <i class="fas fa-play"></i> Start
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div style="padding: 20px; text-align: center;">
            <a href="{{ url_for('phq9_assessment') }}" class="btn btn-primary btn-lg me-3">
                <i class="fas fa-redo"></i> Take Another Assessment
            </a>
            <a href="{{ url_for('patient_dashboard') }}" class="btn btn-secondary btn-lg">
                <i class="fas fa-home"></i> Back to Dashboard
            </a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Exercise timer functions
        function startBreathingExercise() {
            startTimer('breathing-timer', 'breathing-progress', 300); // 5 minutes
        }
        
        function startPMRExercise() {
            startTimer('pmr-timer', 'pmr-progress', 600); // 10 minutes
        }
        
        function startMeditationExercise() {
            startTimer('meditation-timer', 'meditation-progress', 900); // 15 minutes
        }
        
        function startActivityExercise() {
            startTimer('activity-timer', 'activity-progress', 1200); // 20 minutes
        }
        
        function startTimer(timerId, progressId, duration) {
            const timerElement = document.getElementById(timerId);
            const progressElement = document.getElementById(progressId);
            const button = timerElement.parentElement.parentElement.querySelector('button');
            
            let timeLeft = duration;
            const interval = setInterval(() => {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                const progress = ((duration - timeLeft) / duration) * 100;
                progressElement.style.width = progress + '%';
                
                timeLeft--;
                
                if (timeLeft < 0) {
                    clearInterval(interval);
                    timerElement.textContent = 'Complete!';
                    button.innerHTML = '<i class="fas fa-check"></i> Done';
                    button.disabled = true;
                    
                    // Show completion message
                    alert('Exercise completed! Great job taking care of your mental health!');
                }
            }, 1000);
            
            // Disable button during exercise
            button.disabled = true;
            button.innerHTML = '<i class="fas fa-pause"></i> In Progress';
        }
    </script>
</body>
</html>
